{% extends "base.html" %}

{% block title %}Documents - {{ app_name }}{% endblock %}

{% block content %}
<section class="row g-3 mb-3">
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header"><h5 class="mb-0">Upload / Create Document</h5></div>
      <div class="card-body">
        <form id="documentCreateForm" class="row g-2">
          <input type="hidden" name="document_id" />
          <div class="col-12">
            <label class="form-label mb-1">Buscar cliente por DNI o nombre</label>
            <input class="form-control" id="documentClientFinder" placeholder="Ej: 12345678A o Pedro" autocomplete="off" />
            <div id="documentClientFinderResults" class="list-group mt-1 d-none"></div>
          </div>
          <div class="col-12 d-none" id="documentEditBanner">
            <div class="alert alert-primary py-2 px-3 mb-1 d-flex justify-content-between align-items-center">
              <span>Editing document <strong id="documentEditingIdText"></strong></span>
              <button class="btn btn-sm btn-outline-primary" id="cancelDocumentEditBtn" type="button">Cancel edit</button>
            </div>
          </div>
          <div class="col-md-6">
            <label class="form-label mb-1">Client ID</label>
            <input class="form-control" name="client_id" placeholder="Client ID" required />
          </div>
          <div class="col-md-6">
            <label class="form-label mb-1">Tipo de documento</label>
            <select class="form-select" name="doc_type" required>
              <option value="dni">DNI</option>
              <option value="driving_license">Carnet de conducir</option>
              <option value="cap">CAP</option>
              <option value="tachograph_card">Tarjeta tacografo</option>
              <option value="power_of_attorney">Power of Attorney</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="col-12"><hr class="my-2" /></div>
          <div id="documentDynamicFields" class="row g-2"></div>

          <div class="col-12 d-flex gap-2 align-items-end">
            <button class="btn btn-primary" id="documentSubmitBtn" type="submit">Create Document</button>
            <div class="w-100">
              <label class="form-label mb-1">DOCUMENTO PDF</label>
              <input class="form-control" id="documentPdfUpload" type="file" accept="application/pdf" />
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header"><h5 class="mb-0">Document Search</h5></div>
      <div class="card-body">
        <form id="documentsFilterForm" class="d-flex flex-wrap gap-2">
          <input class="form-control flex-fill min-w-220" name="q" placeholder="Search by client / document" />
          <select class="form-select w-auto" name="doc_type"><option value="">Document type</option><option value="dni">DNI</option><option value="driving_license">Driving license</option><option value="cap">CAP</option><option value="tachograph_card">Tachograph</option><option value="power_of_attorney">Power of attorney</option><option value="other">Other</option></select>
          <select class="form-select w-auto" name="expiration_status"><option value="">Expiration status</option><option value="expired">Expired</option><option value="expiring">Expiring</option><option value="ok">OK</option></select>
          <input class="form-control w-auto" name="client_id" placeholder="Client ID" />
          <button class="btn btn-primary" type="submit">Search</button>
        </form>
      </div>
    </div>
  </div>
</section>

<section class="row g-3">
  <div class="col-xl-7">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Expiring Documents</h5>
        <button class="btn btn-sm btn-outline-secondary" id="refreshDocumentsBtn" type="button">Refresh</button>
      </div>
      <div class="table-responsive">
        <table class="table mb-0">
          <thead><tr><th>ID</th><th>Client</th><th>Type</th><th>Expiration</th><th>PDF</th><th>Actions</th></tr></thead>
          <tbody id="documentsTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-xl-5">
    <div class="card h-100">
      <div class="card-header"><h5 class="mb-0">Missing Documentation Report</h5></div>
      <div class="card-body" id="missingDocsReport">No data loaded.</div>
    </div>
  </div>
</section>
{% endblock %}
